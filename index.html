<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Piggy Photos 🐷📸</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    overflow: hidden; /* Bloquea scroll vertical/horizontal */
    touch-action: none; /* Bloquea gestos táctiles como zoom y scroll */
    user-select: none;
    background: #ffc0cb;
    font-family: 'Comic Sans MS', cursive, sans-serif;
    text-align: center;
  }
  #canvas {
    border: 4px dashed #cc3366;
    background: white;
    max-width: 95vw;
    touch-action: none; /* Bloquea gestos táctiles en el canvas */
  }
  button, input, select {
    margin: 5px;
    padding: 10px;
    border-radius: 10px;
    font-size: 1em;
    border: none;
    cursor: pointer;
  }
  #stickers span {
    font-size: 40px;
    cursor: grab;
    user-select: none;
    margin: 0 5px;
  }
</style>
</head>
<body>

<h1>🐷 Piggy Photos 📸</h1>

<input type="file" id="upload" accept="image/*" />
<input type="color" id="colorPicker" value="#ff0000" />
<button id="btnToggleBrush">🖌️ Pincel ON</button>
<button onclick="clearCanvas()">🧹 Limpiar</button>
<button onclick="save()">💾 Guardar</button>

<br />

<canvas id="canvas" width="400" height="400"></canvas>

<br />

<div id="stickers" title="Arrastra los stickers al lienzo">
  <span draggable="true">🐷</span>
  <span draggable="true">🐽</span>
  <span draggable="true">🐖</span>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const upload = document.getElementById("upload");
const colorPicker = document.getElementById("colorPicker");
const btnToggleBrush = document.getElementById("btnToggleBrush");

let painting = false;
let brushEnabled = true;

// Evitar scroll y gestos del navegador en el canvas y document body
['touchstart', 'touchmove', 'touchend', 'touchcancel'].forEach(evt => {
  document.body.addEventListener(evt, e => {
    if (e.target === canvas || canvas.contains(e.target)) {
      e.preventDefault();
    }
  }, { passive: false });
});

canvas.addEventListener("touchstart", e => {
  if (!brushEnabled) return;
  painting = true;
  drawTouch(e.touches[0]);
}, { passive: false });

canvas.addEventListener("touchmove", e => {
  if (!painting || !brushEnabled) return;
  drawTouch(e.touches[0]);
}, { passive: false });

canvas.addEventListener("touchend", e => {
  painting = false;
}, { passive: false });

canvas.addEventListener("mousedown", () => {
  if (brushEnabled) painting = true;
});
canvas.addEventListener("mouseup", () => {
  painting = false;
});
canvas.addEventListener("mousemove", e => {
  if (painting && brushEnabled) drawMouse(e);
});

function drawMouse(e) {
  const rect = canvas.getBoundingClientRect();
  ctx.fillStyle = colorPicker.value;
  ctx.beginPath();
  ctx.arc(e.clientX - rect.left, e.clientY - rect.top, 5, 0, Math.PI * 2);
  ctx.fill();
}

function drawTouch(touch) {
  const rect = canvas.getBoundingClientRect();
  ctx.fillStyle = colorPicker.value;
  ctx.beginPath();
  ctx.arc(touch.clientX - rect.left, touch.clientY - rect.top, 5, 0, Math.PI * 2);
  ctx.fill();
}

btnToggleBrush.addEventListener("click", () => {
  brushEnabled = !brushEnabled;
  btnToggleBrush.textContent = brushEnabled ? "🖌️ Pincel ON" : "❌ Pincel OFF";
});

function clearCanvas() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function save() {
  const link = document.createElement("a");
  link.download = "piggy-photo.png";
  link.href = canvas.toDataURL();
  link.click();
}

upload.addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = evt => {
    const img = new Image();
    img.onload = () => {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0);
    };
    img.src = evt.target.result;
  };
  reader.readAsDataURL(file);
});

// Stickers arrastrables
document.querySelectorAll("#stickers span").forEach(sticker => {
  sticker.addEventListener("dragstart", e => {
    e.dataTransfer.setData("text/plain", sticker.textContent);
  });
});

canvas.addEventListener("dragover", e => e.preventDefault());

canvas.addEventListener("drop", e => {
  e.preventDefault();
  const emoji = e.dataTransfer.getData("text/plain");
  if (!emoji) return;
  const rect = canvas.getBoundingClientRect();
  ctx.font = "40px serif";
  ctx.fillText(emoji, e.clientX - rect.left, e.clientY - rect.top);
});
</script>

<p style="margin: 20px;">Hecho por PiggyStudio121 😺</p>

</body>
</html>
