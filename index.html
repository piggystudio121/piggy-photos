<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Piggy Photos 🐷📸</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    overflow: hidden;
    touch-action: none;
    user-select: none;
    background: #ffc0cb;
    font-family: 'Comic Sans MS', cursive, sans-serif;
    text-align: center;
  }
  #canvas {
    border: 4px dashed #cc3366;
    background: white;
    max-width: 95vw;
    touch-action: none;
  }
  button, input, select {
    margin: 5px;
    padding: 10px;
    border-radius: 10px;
    font-size: 1em;
    border: none;
    cursor: pointer;
  }
  #stickers span {
    font-size: 40px;
    cursor: grab;
    user-select: none;
    margin: 0 5px;
  }
</style>
</head>
<body>

<h1>🐷 Piggy Photos 📸</h1>

<input type="file" id="upload" accept="image/*" />
<button onclick="clearCanvas()">🧹 Limpiar</button>
<button onclick="save()">💾 Guardar</button>

<br />

<canvas id="canvas" width="400" height="400"></canvas>

<br />

<div id="stickers" title="Arrastra los stickers al lienzo">
  <span draggable="true">🐷</span>
  <span draggable="true">🐽</span>
  <span draggable="true">🐖</span>
  <span draggable="true">😻</span>
  <span draggable="true">🎀</span>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const upload = document.getElementById("upload");

// Evitar scroll y gestos táctiles
['touchstart', 'touchmove', 'touchend', 'touchcancel'].forEach(evt => {
  document.body.addEventListener(evt, e => {
    if (e.target === canvas || canvas.contains(e.target)) {
      e.preventDefault();
    }
  }, { passive: false });
});

// Subir imagen y redimensionarla
upload.addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = evt => {
    const img = new Image();
    img.onload = () => {
      const maxWidth = window.innerWidth * 0.95;
      const maxHeight = window.innerHeight * 0.6;
      let imgWidth = img.width;
      let imgHeight = img.height;
      const widthRatio = maxWidth / imgWidth;
      const heightRatio = maxHeight / imgHeight;
      const scale = Math.min(widthRatio, heightRatio, 1);
      const newWidth = imgWidth * scale;
      const newHeight = imgHeight * scale;
      canvas.width = newWidth;
      canvas.height = newHeight;
      ctx.clearRect(0, 0, newWidth, newHeight);
      ctx.drawImage(img, 0, 0, newWidth, newHeight);
    };
    img.src = evt.target.result;
  };
  reader.readAsDataURL(file);
});

function clearCanvas() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function save() {
  const link = document.createElement("a");
  link.download = "piggy-photo.png";
  link.href = canvas.toDataURL();
  link.click();
}

// Stickers
document.querySelectorAll("#stickers span").forEach(sticker => {
  sticker.addEventListener("dragstart", e => {
    e.dataTransfer.setData("text/plain", sticker.textContent);
  });
});

canvas.addEventListener("dragover", e => e.preventDefault());

canvas.addEventListener("drop", e => {
  e.preventDefault();
  const emoji = e.dataTransfer.getData("text/plain");
  if (!emoji) return;
  const rect = canvas.getBoundingClientRect();
  ctx.font = "40px serif";
  ctx.fillText(emoji, e.clientX - rect.left, e.clientY - rect.top);
});
</script>

<p style="margin: 20px;">Hecho con amor por PiggyStudio121 🐷💖</p>

</body>
</html>
